# ceph-demo



## Описание

Данный проект автоматизирует сборку кластера CEPH на 4 ноды. На три из них устанавливаются сервисы MON, MGR. Для каждой ноды создаются по два блочных устройства по 6Гб, для использования сервисами OSD.  

Четвертая нода предназначена для тестирования дополнительных сервисов (RGW, MDS, iSCSI, NVMe-Of и другие)  

Для использования необходимо установить следующие компоненты:

```
chef_workstation => v21
virtualbox == v6.1
```


## Использование
Вам понадобится настроенное окружение Ubuntu 20.04. Минимум 20Gb свободного метса на диске  

1 - Скачайте репозиторий  
2 - Установите зависимости:  

chef_workstation
```
wget https://packages.chef.io/files/stable/chef-workstation/21.10.640/ubuntu/20.04/chef-workstation_21.10.640-1_amd64.deb
dpkg -i ./chef-workstation_21.10.640-1_amd64.deb
```
virtualbox
```
wget https://download.virtualbox.org/virtualbox/7.0.14/virtualbox-7.0_7.0.14-161095~Ubuntu~focal_amd64.deb
dpkg -i ./virtualbox-6.1_6.1.50-161033~Ubuntu~focal_amd64.deb
```
Возможно потребуется установить какие-то дополнительные зависимости. Следуйте инструкциям пакетного менеджера.  


3 - Используйте утилиту kitchen для подготовки демо стенда  
```
# Создайте ноды
kitchen create

# Сконфигурирйте ноды
kitchen converge

```
4 - После первого прогона chef-client на виртуальных машинах, потребуется повторить пунк 3 один или два раза, для того чтобы собрался кворум из сервисов MON и все ноды добавились в кластер. Связано с тем, что сначала устанавливаются компоненты CEPH а затем происходит бутстрап кластера и добавление в него хостов  

5 - Залогиньтесь в на первую ноду стенда  
```
kitchen login node1
```

